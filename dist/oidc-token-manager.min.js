!function(){function e(e,t){t=t||{};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function t(e){if(e){if(this.profile=e.profile,this.id_token=e.id_token,this.access_token=e.access_token,e.access_token)this.expires_at=parseInt(e.expires_at);else{if(!e.id_token)throw Error("Either access_token or id_token required.");this.expires_at=e.profile.exp}this.scope=e.scope,this.session_state=e.session_state}else this.expires_at=0;Object.defineProperty(this,"scopes",{get:function(){return(this.scope||"").split(" ")}}),Object.defineProperty(this,"expired",{get:function(){var e=parseInt(Date.now()/1e3);return this.expires_at<e}}),Object.defineProperty(this,"expires_in",{get:function(){var e=parseInt(Date.now()/1e3);return this.expires_at-e}})}function n(e,t){this.url=e,t=t||{},t.cancelDelay=t.cancelDelay||5e3,this.config=t}function o(e){if(e._token=null,e._settings.persist){var n=e._settings.store.getItem(e._settings.persistKey);if(n){var o=t.fromJSON(n);o.expired||(e._token=o)}}}function i(e){function t(){r=null,e._callTokenExpiring()}function n(){r&&(window.clearTimeout(r),r=null)}function o(e){r=window.setTimeout(t,1e3*e)}function i(){if(n(),!e.expired){var i=e.expires_in;i>60?o(i-60):t()}}var r=null;i(),e.addOnTokenObtained(i),e.addOnTokenRemoved(n)}function r(e){e._settings.silent_redirect_uri&&e._settings.silent_renew&&e.addOnTokenExpiring(function(){e.renewTokenSilentAsync()["catch"](function(t){e._callSilentTokenRenewFailed(),console.error(t&&t.message||"Unknown error")})})}function s(e){function t(){r=null,e._token&&e.saveToken(null),e._callTokenExpired()}function n(){r&&(window.clearTimeout(r),r=null)}function o(e){r=window.setTimeout(t,1e3*e)}function i(){n(),e.expires_in>0&&o(e.expires_in+1)}var r=null;i(),e.addOnTokenObtained(i),e.addOnTokenRemoved(n)}function c(e){this._settings=e||{},"undefined"==typeof this._settings.persist&&(this._settings.persist=!0),this._settings.store=this._settings.store||window.localStorage,this._settings.persistKey=this._settings.persistKey||"TokenManager.token",this.oidcClient=new OidcClient(this._settings),this._callbacks={tokenRemovedCallbacks:[],tokenExpiringCallbacks:[],tokenExpiredCallbacks:[],tokenObtainedCallbacks:[],silentTokenRenewFailedCallbacks:[]},Object.defineProperty(this,"profile",{get:function(){return this._token?this._token.profile:void 0}}),Object.defineProperty(this,"id_token",{get:function(){return this._token?this._token.id_token:void 0}}),Object.defineProperty(this,"access_token",{get:function(){return this._token&&!this._token.expired?this._token.access_token:void 0}}),Object.defineProperty(this,"expired",{get:function(){return this._token?this._token.expired:!0}}),Object.defineProperty(this,"expires_in",{get:function(){return this._token?this._token.expires_in:0}}),Object.defineProperty(this,"expires_at",{get:function(){return this._token?this._token.expires_at:0}}),Object.defineProperty(this,"scope",{get:function(){return this._token&&this._token.scope}}),Object.defineProperty(this,"scopes",{get:function(){return this._token?[].concat(this._token.scopes):[]}}),Object.defineProperty(this,"session_state",{get:function(){return this._token?this._token.session_state:void 0}});var t=this;o(t),t._settings.store instanceof window.localStorage.constructor&&window.addEventListener("storage",function(e){e.key===t._settings.persistKey&&(o(t),t._token?t._callTokenObtained():t._callTokenRemoved())}),s(t),r(t),window.setTimeout(function(){i(t)},0)}var a=OidcClient._promiseFactory,l=OidcClient._httpRequest;t.fromResponse=function(e){if(e.access_token){var n=parseInt(Date.now()/1e3);e.expires_at=n+parseInt(e.expires_in)}return new t(e)},t.fromJSON=function(e){if(e)try{var n=JSON.parse(e);return new t(n)}catch(o){}return new t(null)},t.prototype.toJSON=function(){return JSON.stringify({profile:this.profile,id_token:this.id_token,access_token:this.access_token,expires_at:this.expires_at,scope:this.scopes.join(" "),session_state:this.session_state})},n.prototype.loadAsync=function(e){var t=this;return e=e||this.url,e?a.create(function(n,o){function i(){window.removeEventListener("message",s,!1),a&&window.clearTimeout(a),a=null,window.document.body.removeChild(c)}function r(e){i(),o(Error("Timeout on loading frame"))}function s(e){a&&e.origin===location.protocol+"//"+location.host&&e.source==c.contentWindow&&(i(),n(e.data))}var c=window.document.createElement("iframe");c.style.display="none";var a=window.setTimeout(r,t.config.cancelDelay);window.addEventListener("message",s,!1),window.document.body.appendChild(c),c.src=e}):a.reject(Error("No url provided"))},c.setPromiseFactory=function(e){a=e},c.setHttpRequest=function(e){if("object"!=typeof e||"function"!=typeof e.getJSON)throw Error("The provided value is not a valid http request.");l=e},c.prototype._callTokenRemoved=function(){this._callbacks.tokenRemovedCallbacks.forEach(function(e){e()})},c.prototype._callTokenExpiring=function(){this._callbacks.tokenExpiringCallbacks.forEach(function(e){e()})},c.prototype._callTokenExpired=function(){this._callbacks.tokenExpiredCallbacks.forEach(function(e){e()})},c.prototype._callTokenObtained=function(){this._callbacks.tokenObtainedCallbacks.forEach(function(e){e()})},c.prototype._callSilentTokenRenewFailed=function(){this._callbacks.silentTokenRenewFailedCallbacks.forEach(function(e){e()})},c.prototype.saveToken=function(e){!e||e instanceof t||(e=t.fromResponse(e)),this._token=e,this._settings.persist&&!this.expired?this._settings.store.setItem(this._settings.persistKey,e.toJSON()):this._settings.store.removeItem(this._settings.persistKey),e?this._callTokenObtained():this._callTokenRemoved()},c.prototype.addOnTokenRemoved=function(e){this._callbacks.tokenRemovedCallbacks.push(e)},c.prototype.addOnTokenObtained=function(e){this._callbacks.tokenObtainedCallbacks.push(e)},c.prototype.addOnTokenExpiring=function(e){this._callbacks.tokenExpiringCallbacks.push(e)},c.prototype.addOnTokenExpired=function(e){this._callbacks.tokenExpiredCallbacks.push(e)},c.prototype.addOnSilentTokenRenewFailed=function(e){this._callbacks.silentTokenRenewFailedCallbacks.push(e)},c.prototype.removeToken=function(){this.saveToken(null)},c.prototype.redirectForToken=function(){var e=this.oidcClient;return e.createTokenRequestAsync().then(function(e){window.location=e.url},function(e){return console.error("TokenManager.redirectForToken error: "+(e&&e.message||"Unknown error")),a.reject(e)})},c.prototype.redirectForLogout=function(){var e=this;return e.oidcClient.createLogoutRequestAsync(e.id_token).then(function(t){e.removeToken(),window.location=t},function(e){return console.error("TokenManager.redirectForLogout error: "+(e&&e.message||"Unknown error")),a.reject(e)})},c.prototype.processTokenCallbackAsync=function(e){var t=this;return t.oidcClient.processResponseAsync(e).then(function(e){t.saveToken(e)})},c.prototype.renewTokenSilentAsync=function(){var t=this;if(!t._settings.silent_redirect_uri)return a.reject(Error("silent_redirect_uri not configured"));var o=e(t._settings);o.redirect_uri=o.silent_redirect_uri,o.prompt||(o.prompt="none");var i=new OidcClient(o);return i.createTokenRequestAsync().then(function(e){var o=new n(e.url,{cancelDelay:t._settings.silent_renew_timeout});return o.loadAsync().then(function(e){return i.processResponseAsync(e).then(function(e){t.saveToken(e)})})})},c.prototype.processTokenCallbackSilent=function(e){if(window.parent&&window!==window.parent){var e=e||window.location.hash;e&&window.parent.postMessage(e,location.protocol+"//"+location.host)}},c.prototype.openPopupForTokenAsync=function(t){function n(e){p&&window.clearInterval(p),c.close(),delete r._pendingPopup,e&&delete window[e]}function o(){c.window||(n(),l(Error("Popup closed")))}t=t||{},t.features=t.features||"location=no,toolbar=no",t.target=t.target||"_blank";var i="tokenmgr_callback_";window.openPopupForTokenAsyncCallback||(window.openPopupForTokenAsyncCallback=function(e){var t=OidcClient.parseOidcResult(e);t&&t.state&&window[i+t.state]&&window[i+t.state](e)});var r=this,s=e(r._settings);if(s.redirect_uri=s.popup_redirect_uri||s.redirect_uri,r._pendingPopup)return a.create(function(e,t){t(Error("Already a pending popup token request."))});var c=window.open(s.redirect_uri,t.target,t.features);if(!c)return a.create(function(e,t){t(Error("Error opening popup."))});r._pendingPopup=!0;var l,p=window.setInterval(o,1e3);return a.create(function(e,t){l=t;var o=new OidcClient(s);o.createTokenRequestAsync().then(function(s){function a(){c.setUrl?c.setUrl(s.url):d>f?(f++,window.setTimeout(a,u)):(n(l),t(Error("Timeout error on popup")))}var l=i+s.request_state.state;window[l]=function(i){n(l),o.processResponseAsync(i).then(function(t){r.saveToken(t),e()},function(e){t(e)})};var p=5,u=500,d=1e3*p/u,f=0;a()},function(e){n(),t(e)})})},c.prototype.processTokenPopup=function(e){e=e||window.location.hash,window.setUrl=function(e){window.location=e},e&&window.opener.openPopupForTokenAsyncCallback(e)},window.OidcTokenManager=c}();