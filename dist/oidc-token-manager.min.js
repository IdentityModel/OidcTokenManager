!function(){function e(){function e(e,t){for(var n=Object.keys(t),o=0;o<n.length;o++){var i=n[o],r=t[i];e.setRequestHeader(i,r)}}this.getJSON=function(t,n){return l.create(function(o,i){try{var r=new XMLHttpRequest;r.open("GET",t),r.responseType="json",n&&n.headers&&e(r,n.headers),r.onload=function(){try{if(200===r.status){var e=r.response;"string"==typeof e&&(e=JSON.parse(e)),o(e)}else i(Error(r.statusText+"("+r.status+")"))}catch(t){i(t)}},r.onerror=function(){i(Error("Network error"))},r.send()}catch(s){return i(s)}})}}function t(e){this.then=function(n,o){var i=e.then(n,o);return new t(i)},this["catch"]=function(n){var o=e["catch"](n);return new t(o)}}function n(){this.resolve=function(e){return new t(Promise.resolve(e))},this.reject=function(e){return new t(Promise.reject(e))},this.create=function(e){return new t(new Promise(e))}}function o(e,t){t=t||{};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function i(e){if(e){if(this.profile=e.profile,this.id_token=e.id_token,this.access_token=e.access_token,e.access_token)this.expires_at=parseInt(e.expires_at);else{if(!e.id_token)throw Error("Either access_token or id_token required.");this.expires_at=e.profile.exp}this.scope=e.scope,this.session_state=e.session_state}else this.expires_at=0;Object.defineProperty(this,"scopes",{get:function(){return(this.scope||"").split(" ")}}),Object.defineProperty(this,"expired",{get:function(){var e=parseInt(Date.now()/1e3);return this.expires_at<e}}),Object.defineProperty(this,"expires_in",{get:function(){var e=parseInt(Date.now()/1e3);return this.expires_at-e}})}function r(e,t){this.url=e,this.config=t||{}}function s(e){if(e._token=null,e._settings.persist){var t=e._settings.store.getItem(e._settings.persistKey);if(t){var n=i.fromJSON(t);n.expired||(e._token=n)}}}function c(e){function t(){r=null,e._callTokenExpiring()}function n(){r&&(window.clearTimeout(r),r=null)}function o(e){r=window.setTimeout(t,1e3*e)}function i(){if(n(),!e.expired){var i=e.expires_in;i>60?o(i-60):t()}}var r=null;i(),e.addOnTokenObtained(i),e.addOnTokenRemoved(n)}function a(e){e._settings.silent_redirect_uri&&e._settings.silent_renew&&e.addOnTokenExpiring(function(){e.renewTokenSilentAsync()["catch"](function(t){e._callSilentTokenRenewFailed(),console.error(t.message||t)})})}function u(e){function t(){r=null,e._token&&e.saveToken(null),e._callTokenExpired()}function n(){r&&(window.clearTimeout(r),r=null)}function o(e){r=window.setTimeout(t,1e3*e)}function i(){n(),e.expires_in>0&&o(e.expires_in+1)}var r=null;i(),e.addOnTokenObtained(i),e.addOnTokenRemoved(n)}function p(e){this._settings=e||{},"undefined"==typeof this._settings.persist&&(this._settings.persist=!0),this._settings.store=this._settings.store||window.localStorage,this._settings.persistKey=this._settings.persistKey||"TokenManager.token",this.oidcClient=new OidcClient(this._settings),this._callbacks={tokenRemovedCallbacks:[],tokenExpiringCallbacks:[],tokenExpiredCallbacks:[],tokenObtainedCallbacks:[],silentTokenRenewFailedCallbacks:[]},Object.defineProperty(this,"profile",{get:function(){return this._token?this._token.profile:void 0}}),Object.defineProperty(this,"id_token",{get:function(){return this._token?this._token.id_token:void 0}}),Object.defineProperty(this,"access_token",{get:function(){return this._token&&!this._token.expired?this._token.access_token:void 0}}),Object.defineProperty(this,"expired",{get:function(){return this._token?this._token.expired:!0}}),Object.defineProperty(this,"expires_in",{get:function(){return this._token?this._token.expires_in:0}}),Object.defineProperty(this,"expires_at",{get:function(){return this._token?this._token.expires_at:0}}),Object.defineProperty(this,"scope",{get:function(){return this._token&&this._token.scope}}),Object.defineProperty(this,"scopes",{get:function(){return this._token?[].concat(this._token.scopes):[]}}),Object.defineProperty(this,"session_state",{get:function(){return this._token?this._token.session_state:void 0}});var t=this;s(t),t._settings.store instanceof window.localStorage.constructor&&window.addEventListener("storage",function(e){e.key===t._settings.persistKey&&(s(t),t._token?t._callTokenObtained():t._callTokenRemoved())}),u(t),a(t),window.setTimeout(function(){c(t)},0)}var l,d;d=new e,l=new n;var d=new e,l=new n;i.fromResponse=function(e){if(e.access_token){var t=parseInt(Date.now()/1e3);e.expires_at=t+parseInt(e.expires_in)}return new i(e)},i.fromJSON=function(e){if(e)try{var t=JSON.parse(e);return new i(t)}catch(n){}return new i(null)},i.prototype.toJSON=function(){return JSON.stringify({profile:this.profile,id_token:this.id_token,access_token:this.access_token,expires_at:this.expires_at,scope:this.scopes.join(" "),session_state:this.session_state})},r.prototype.loadAsync=function(e){var t=this;return e=e||this.url,e?l.create(function(n,o){function i(){window.removeEventListener("message",s,!1),a&&window.clearTimeout(a),a=null,window.document.body.removeChild(c)}function r(e){i(),o()}function s(e){a&&e.origin===location.protocol+"//"+location.host&&e.source==c.contentWindow&&(i(),n(e.data))}var c=window.document.createElement("iframe");c.style.display="none";var a=window.setTimeout(r,t.cancelDelay||5e3);window.addEventListener("message",s,!1),window.document.body.appendChild(c),c.src=e}):l.reject("No url provided")},p.setPromiseFactory=function(e){l=e},p.setHttpRequest=function(e){if("object"!=typeof e||"function"!=typeof e.getJSON)throw Error("The provided value is not a valid http request.");d=e},p.prototype._callTokenRemoved=function(){this._callbacks.tokenRemovedCallbacks.forEach(function(e){e()})},p.prototype._callTokenExpiring=function(){this._callbacks.tokenExpiringCallbacks.forEach(function(e){e()})},p.prototype._callTokenExpired=function(){this._callbacks.tokenExpiredCallbacks.forEach(function(e){e()})},p.prototype._callTokenObtained=function(){this._callbacks.tokenObtainedCallbacks.forEach(function(e){e()})},p.prototype._callSilentTokenRenewFailed=function(){this._callbacks.silentTokenRenewFailedCallbacks.forEach(function(e){e()})},p.prototype.saveToken=function(e){!e||e instanceof i||(e=i.fromResponse(e)),this._token=e,this._settings.persist&&!this.expired?this._settings.store.setItem(this._settings.persistKey,e.toJSON()):this._settings.store.removeItem(this._settings.persistKey),e?this._callTokenObtained():this._callTokenRemoved()},p.prototype.addOnTokenRemoved=function(e){this._callbacks.tokenRemovedCallbacks.push(e)},p.prototype.addOnTokenObtained=function(e){this._callbacks.tokenObtainedCallbacks.push(e)},p.prototype.addOnTokenExpiring=function(e){this._callbacks.tokenExpiringCallbacks.push(e)},p.prototype.addOnTokenExpired=function(e){this._callbacks.tokenExpiredCallbacks.push(e)},p.prototype.addOnSilentTokenRenewFailed=function(e){this._callbacks.silentTokenRenewFailedCallbacks.push(e)},p.prototype.removeToken=function(){this.saveToken(null)},p.prototype.redirectForToken=function(){var e=this.oidcClient;e.createTokenRequestAsync().then(function(e){window.location=e.url},function(e){console.error("TokenManager.redirectForToken error: "+(e&&e.message||e||""))})},p.prototype.redirectForLogout=function(){var e=this;e.oidcClient.createLogoutRequestAsync(e.id_token).then(function(t){e.removeToken(),window.location=t},function(e){console.error("TokenManager.redirectForLogout error: "+(e&&e.message||e||""))})},p.prototype.processTokenCallbackAsync=function(e){var t=this;return t.oidcClient.processResponseAsync(e).then(function(e){t.saveToken(e)})},p.prototype.renewTokenSilentAsync=function(){var e=this;if(!e._settings.silent_redirect_uri)return l.reject("silent_redirect_uri not configured");var t=o(e._settings);t.redirect_uri=t.silent_redirect_uri,t.prompt="none";var n=new OidcClient(t);return n.createTokenRequestAsync().then(function(t){var o=new r(t.url,{cancelDelay:e._settings.silent_renew_timeout});return o.loadAsync().then(function(t){return n.processResponseAsync(t).then(function(t){e.saveToken(t)})})})},p.prototype.processTokenCallbackSilent=function(e){if(window.parent&&window!==window.parent){var e=e||window.location.hash;e&&window.parent.postMessage(e,location.protocol+"//"+location.host)}},p.prototype.openPopupForTokenAsync=function(e){function t(e){u&&window.clearInterval(u),c.close(),delete r._pendingPopup,e&&delete window[e]}function n(){c.window||(t(),a(Error({msg:"Popup closed"})))}e=e||{},e.features=e.features||"location=no,toolbar=no",e.target=e.target||"_blank";var i="tokenmgr_callback_";window.openPopupForTokenAsyncCallback||(window.openPopupForTokenAsyncCallback=function(e){var t=OidcClient.parseOidcResult(e);t&&t.state&&window[i+t.state]&&window[i+t.state](e)});var r=this,s=o(r._settings);if(s.redirect_uri=s.popup_redirect_uri||s.redirect_uri,r._pendingPopup)return l.create(function(e,t){t(Error("Already a pending popup token request."))});var c=window.open(s.redirect_uri,e.target,e.features);if(!c)return l.create(function(e,t){t(Error("Error opening popup."))});r._pendingPopup=!0;var a,u=window.setInterval(n,1e3);return l.create(function(e,n){a=n;var o=new OidcClient(s);o.createTokenRequestAsync().then(function(s){function a(){c.setUrl?c.setUrl(s.url):d>f?(f++,window.setTimeout(a,l)):(t(u),n(Error("Timeout error on popup")))}var u=i+s.request_state.state;window[u]=function(i){t(u),o.processResponseAsync(i).then(function(t){r.saveToken(t),e()},function(e){n(e)})};var p=5,l=500,d=1e3*p/l,f=0;a()},function(e){t(),n(e)})})},p.prototype.processTokenPopup=function(e){e=e||window.location.hash,window.setUrl=function(e){window.location=e},e&&window.opener.openPopupForTokenAsyncCallback(e)},window.OidcTokenManager=p}();